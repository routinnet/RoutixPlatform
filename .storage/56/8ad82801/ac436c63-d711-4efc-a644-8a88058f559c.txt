$ mkdir -p /workspace/backend/{app/{core,models,schemas,api/{v1/endpoints},services,workers,utils},alembic/versions,scripts,tests}
$ cd /workspace/backend && find . -type d

.
./alembic
./alembic/versions
./app
./app/api
./app/api/{v1
./app/api/{v1/endpoints}
./app/core
./app/models
./app/schemas
./app/services
./app/utils
./app/workers
./scripts
./tests
$ which psql || echo "PostgreSQL not found, installing..."

PostgreSQL not found, installing...
$ apt-get update && apt-get install -y postgresql-15 postgresql-contrib-15 postgresql-15-pgvector

E: setgroups 65534 failed - setgroups (1: Operation not permitted)
E: setegid 65534 failed - setegid (22: Invalid argument)
E: seteuid 100 failed - seteuid (22: Invalid argument)
E: setgroups 0 failed - setgroups (1: Operation not permitted)
rm: cannot remove '/var/cache/apt/archives/partial/*.deb': Permission denied
Reading package lists...
W: chown to _apt:root of directory /var/lib/apt/lists/partial failed - SetupAPTPartialDirectory (22: Invalid argument)
W: chown to _apt:root of directory /var/lib/apt/lists/auxfiles failed - SetupAPTPartialDirectory (22: Invalid argument)
E: setgroups 65534 failed - setgroups (1: Operation not permitted)
E: setegid 65534 failed - setegid (22: Invalid argument)
E: seteuid 100 failed - seteuid (22: Invalid argument)
E: setgroups 0 failed - setgroups (1: Operation not permitted)
E: Method gave invalid 400 URI Failure message: Failed to setgroups - setgroups (1: Operation not permitted)
E: Method gave invalid 400 URI Failure message: Failed to setgroups - setgroups (1: Operation not permitted)
E: Method gave invalid 400 URI Failure message: Failed to setgroups - setgroups (1: Operation not permitted)
E: Method http has died unexpectedly!
E: Sub-process http returned an error code (112)
E: Method https has died unexpectedly!
E: Sub-process https returned an error code (112)
$ service postgresql start

postgresql: unrecognized service
$ sudo -u postgres createdb routix

bash: line 16: sudo: command not found
$ sudo -u postgres psql -d routix -c "CREATE EXTENSION IF NOT EXISTS vector;"

bash: line 19: sudo: command not found
$ sudo -u postgres psql -d routix -c "CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";"

bash: line 22: sudo: command not found
$ sudo -u postgres psql -d routix -c "SELECT extname FROM pg_extension WHERE extname IN ('vector', 'uuid-ossp');"

bash: line 25: sudo: command not found
$ cd /workspace/backend && python3 -m pip install sqlalchemy alembic asyncpg psycopg2-binary pgvector sqlite-vec fastapi uvicorn python-multipart

Requirement already satisfied: sqlalchemy in /data/.cache/python/lib/python3.10/site-packages (2.0.23)
Collecting alembic
  Downloading alembic-1.16.5-py3-none-any.whl.metadata (7.3 kB)
Collecting asyncpg
  Downloading asyncpg-0.30.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (5.0 kB)
Requirement already satisfied: psycopg2-binary in /data/.cache/python/lib/python3.10/site-packages (2.9.9)
Collecting pgvector
  Downloading pgvector-0.4.1-py3-none-any.whl.metadata (18 kB)
Collecting sqlite-vec
  Downloading sqlite_vec-0.1.6-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux1_x86_64.whl.metadata (198 bytes)
Requirement already satisfied: fastapi in /data/.cache/python/lib/python3.10/site-packages (0.104.1)
Requirement already satisfied: uvicorn in /data/.cache/python/lib/python3.10/site-packages (0.24.0)
Requirement already satisfied: python-multipart in /data/.cache/python/lib/python3.10/site-packages (0.0.6)
Requirement already satisfied: typing-extensions>=4.2.0 in /data/.cache/python/lib/python3.10/site-packages (from sqlalchemy) (4.15.0)
Requirement already satisfied: greenlet!=0.4.17 in /data/.cache/python/lib/python3.10/site-packages (from sqlalchemy) (3.2.4)
Collecting Mako (from alembic)
  Downloading mako-1.3.10-py3-none-any.whl.metadata (2.9 kB)
Requirement already satisfied: tomli in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from alembic) (2.2.1)
Requirement already satisfied: async-timeout>=4.0.3 in /data/.cache/python/lib/python3.10/site-packages (from asyncpg) (5.0.1)
Requirement already satisfied: numpy in /data/.cache/python/lib/python3.10/site-packages (from pgvector) (2.2.6)
Requirement already satisfied: anyio<4.0.0,>=3.7.1 in /data/.cache/python/lib/python3.10/site-packages (from fastapi) (3.7.1)
Requirement already satisfied: pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4 in /data/.cache/python/lib/python3.10/site-packages (from fastapi) (2.11.7)
Requirement already satisfied: starlette<0.28.0,>=0.27.0 in /data/.cache/python/lib/python3.10/site-packages (from fastapi) (0.27.0)
Requirement already satisfied: idna>=2.8 in /data/.cache/python/lib/python3.10/site-packages (from anyio<4.0.0,>=3.7.1->fastapi) (3.10)
Requirement already satisfied: sniffio>=1.1 in /data/.cache/python/lib/python3.10/site-packages (from anyio<4.0.0,>=3.7.1->fastapi) (1.3.1)
Requirement already satisfied: exceptiongroup in /data/.cache/python/lib/python3.10/site-packages (from anyio<4.0.0,>=3.7.1->fastapi) (1.3.0)
Requirement already satisfied: annotated-types>=0.6.0 in /data/.cache/python/lib/python3.10/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi) (0.7.0)
Requirement already satisfied: pydantic-core==2.33.2 in /data/.cache/python/lib/python3.10/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi) (2.33.2)
Requirement already satisfied: typing-inspection>=0.4.0 in /data/.cache/python/lib/python3.10/site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi) (0.4.1)
Requirement already satisfied: click>=7.0 in /data/.cache/python/lib/python3.10/site-packages (from uvicorn) (8.2.1)
Requirement already satisfied: h11>=0.8 in /data/.cache/python/lib/python3.10/site-packages (from uvicorn) (0.16.0)
Requirement already satisfied: MarkupSafe>=0.9.2 in /opt/conda/envs/mgx-chat/lib/python3.10/site-packages (from Mako->alembic) (3.0.2)
Downloading alembic-1.16.5-py3-none-any.whl (247 kB)
Downloading asyncpg-0.30.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.9 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.9/2.9 MB 136.7 MB/s  0:00:00
Downloading pgvector-0.4.1-py3-none-any.whl (27 kB)
Downloading sqlite_vec-0.1.6-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux1_x86_64.whl (151 kB)
Downloading mako-1.3.10-py3-none-any.whl (78 kB)
Installing collected packages: sqlite-vec, pgvector, Mako, asyncpg, alembic

Successfully installed Mako-1.3.10 alembic-1.16.5 asyncpg-0.30.0 pgvector-0.4.1 sqlite-vec-0.1.6
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
$ cd /workspace/backend && python3 -m alembic init alembic

FAILED: Directory alembic already exists and is not empty
$ cd /workspace/backend && rm -rf alembic && python3 -m alembic init alembic

Creating directory /workspace/backend/alembic ...  done
Creating directory /workspace/backend/alembic/versions ...  done
Generating /workspace/backend/alembic/README ...  done
Generating /workspace/backend/alembic.ini ...  done
Generating /workspace/backend/alembic/env.py ...  done
Generating /workspace/backend/alembic/script.py.mako ...  done
Please edit configuration/connection/logging settings in /workspace/backend/alembic.ini before proceeding.
$ cd /workspace/backend && python3 -m alembic revision --autogenerate -m "Initial migration with all tables"

Traceback (most recent call last):
  File "/opt/conda/envs/mgx-chat/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/opt/conda/envs/mgx-chat/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/__main__.py", line 4, in <module>
    main(prog="alembic")
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/config.py", line 1022, in main
    CommandLine(prog=prog).main(argv=argv)
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/config.py", line 1012, in main
    self.run_cmd(cfg, options)
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/config.py", line 946, in run_cmd
    fn(
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/command.py", line 309, in revision
    script_directory.run_env()
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/script/base.py", line 549, in run_env
    util.load_python_file(self.dir, "env.py")
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/util/pyfiles.py", line 116, in load_python_file
    module = load_module_py(module_id, path)
  File "/data/.cache/python/lib/python3.10/site-packages/alembic/util/pyfiles.py", line 136, in load_module_py
    spec.loader.exec_module(module)  # type: ignore
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/workspace/backend/alembic/env.py", line 17, in <module>
    from app.core.database import Base
  File "/workspace/backend/./app/core/database.py", line 10, in <module>
    engine = create_async_engine(
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/engine.py", line 117, in create_async_engine
    sync_engine = _create_engine(url, **kw)
  File "<string>", line 2, in create_engine
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/util/deprecations.py", line 281, in warned
    return fn(*args, **kwargs)  # type: ignore[no-any-return]
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/engine/create.py", line 601, in create_engine
    dbapi = dbapi_meth(**dbapi_args)
  File "/data/.cache/python/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 374, in import_dbapi
    __import__("aiosqlite"), __import__("sqlite3")
ModuleNotFoundError: No module named 'aiosqlite'
